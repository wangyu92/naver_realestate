<%
  # Enhanced property card for search results
  property ||= {}
%>

<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow duration-200">
  <!-- Property Image -->
  <div class="relative aspect-[4/3] bg-gray-100">
    <% if property[:images]&.first %>
      <img src="<%= property[:images].first %>" 
           alt="<%= property[:title] %>"
           class="w-full h-full object-cover">
    <% else %>
      <!-- Placeholder image -->
      <div class="w-full h-full flex items-center justify-center">
        <svg class="w-16 h-16 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
      </div>
    <% end %>
    
    <!-- Property type badge -->
    <div class="absolute top-3 left-3">
      <%= render 'components/badge', 
          text: property[:type] || 'Îß§Î¨º', 
          variant: property[:type] == 'ÏïÑÌååÌä∏' ? 'primary' : property[:type] == 'Ïò§ÌîºÏä§ÌÖî' ? 'secondary' : 'gray',
          size: 'sm' %>
    </div>
    
    <!-- Photo count badge -->
    <% if property[:images]&.length.to_i > 1 %>
      <div class="absolute top-3 right-3 bg-black/70 text-white text-xs px-2 py-1 rounded-full">
        üì∑ <%= property[:images].length %>
      </div>
    <% end %>
    
    <!-- New/Hot badges -->
    <div class="absolute bottom-3 left-3 flex gap-1">
      <% if property[:year_built] && property[:year_built] >= 2023 %>
        <%= render 'components/badge', text: 'Ïã†Ï∂ï', variant: 'success', size: 'sm' %>
      <% end %>
    </div>
  </div>
  
  <!-- Property Details -->
  <div class="p-4">
    <!-- Title and Location -->
    <div class="mb-3">
      <h3 class="font-semibold text-gray-900 text-lg mb-1 line-clamp-1">
        <%= property[:title] %>
      </h3>
      
      <p class="text-sm text-gray-600 flex items-center">
        <svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
        <%= property[:address] %>
      </p>
    </div>
    
    <!-- Price -->
    <div class="mb-4">
      <% case property[:transaction_type] %>
      <% when 'Îß§Îß§' %>
        <div class="text-2xl font-bold text-gray-900">
          <%= format_currency(property[:price]) %>
        </div>
      <% when 'Ï†ÑÏÑ∏' %>
        <div class="text-2xl font-bold text-gray-900">
          Ï†ÑÏÑ∏ <%= format_currency(property[:deposit]) %>
        </div>
      <% when 'ÏõîÏÑ∏' %>
        <div class="text-2xl font-bold text-gray-900">
          <% if property[:deposit] && property[:deposit] > 0 %>
            ÏõîÏÑ∏ <%= format_currency(property[:deposit]) %>/<%= format_currency(property[:monthly_rent]) %>
          <% else %>
            ÏõîÏÑ∏ <%= format_currency(property[:monthly_rent]) %>
          <% end %>
        </div>
      <% end %>
    </div>
    
    <!-- Property Specs -->
    <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
      <!-- Area -->
      <div>
        <span class="text-gray-500">Ï†ÑÏö©/Í≥µÍ∏â</span>
        <div class="font-medium">
          <%= property.dig(:area, :exclusive) %>„é°/<%= property.dig(:area, :supply) %>„é°
          <div class="text-xs text-gray-500">
            (<%= (property.dig(:area, :exclusive).to_f / 3.3058).round(1) %>Ìèâ/<%= (property.dig(:area, :supply).to_f / 3.3058).round(1) %>Ìèâ)
          </div>
        </div>
      </div>
      
      <!-- Floor -->
      <div>
        <span class="text-gray-500">Ï∏µÏàò</span>
        <div class="font-medium"><%= property[:floor] %>Ï∏µ</div>
      </div>
    </div>
    
    <!-- Additional Info -->
    <div class="flex flex-wrap gap-2 mb-4">
      <!-- Direction -->
      <% if property[:direction] %>
        <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
          <%= property[:direction] %>
        </span>
      <% end %>
      
      <!-- Built Year -->
      <% if property[:year_built] %>
        <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full">
          <%= property[:year_built] %>ÎÖÑ
        </span>
      <% end %>
      
      <!-- Elevator -->
      <% if property[:has_elevator] %>
        <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">
          ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞
        </span>
      <% end %>
      
      <!-- Parking -->
      <% if property[:parking_ratio] && property[:parking_ratio] > 0 %>
        <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-purple-100 text-purple-800 rounded-full">
          Ï£ºÏ∞® <%= property[:parking_ratio] %>ÎåÄ
        </span>
      <% end %>
    </div>
    
    <!-- Description -->
    <% if property[:description] %>
      <p class="text-sm text-gray-600 mb-4 line-clamp-2">
        <%= property[:description] %>
      </p>
    <% end %>
    
    <!-- Action Buttons -->
    <div class="flex gap-2">
      <button class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
        ÏÉÅÏÑ∏Î≥¥Í∏∞
      </button>
      
      <button class="p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
        </svg>
      </button>
      
      <button class="p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
        </svg>
      </button>
    </div>
  </div>
</div>

<% content_for :helpers do %>
  <% unless defined?(@format_currency_helper_loaded) %>
    <% @format_currency_helper_loaded = true %>
    <script>
      // Helper function to format currency
      window.formatCurrency = function(amount) {
        if (!amount) return '0Ïõê';
        
        if (amount >= 100000000) { // 1Ïñµ Ïù¥ÏÉÅ
          const eok = Math.floor(amount / 100000000);
          const man = Math.floor((amount % 100000000) / 10000);
          return man > 0 ? `${eok}Ïñµ ${man}ÎßåÏõê` : `${eok}ÏñµÏõê`;
        } else if (amount >= 10000) { // 1Îßå Ïù¥ÏÉÅ
          const man = Math.floor(amount / 10000);
          return `${man}ÎßåÏõê`;
        } else {
          return `${amount.toLocaleString()}Ïõê`;
        }
      };
    </script>
  <% end %>
<% end %>

<style>
  /* Line clamp utility */
  .line-clamp-1 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
  }
  
  .line-clamp-2 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
</style>