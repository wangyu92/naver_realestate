<%
  # Range slider component for filtering price, area, year ranges
  label ||= ""
  name ||= ""
  min ||= 0
  max ||= 100
  step ||= 1
  value_min ||= min
  value_max ||= max
  unit ||= ""
  format ||= "number"
  show_inputs ||= true
  id ||= "range_#{name.gsub(/[\[\]]/, '_')}"
%>

<div class="range-slider-container mb-6" data-controller="range-slider" 
     data-range-slider-min-value="<%= min %>"
     data-range-slider-max-value="<%= max %>"
     data-range-slider-step-value="<%= step %>"
     data-range-slider-format-value="<%= format %>">
  
  <% if label.present? %>
    <label class="block text-sm font-medium text-gray-700 mb-3">
      <%= label %>
    </label>
  <% end %>

  <div class="range-slider-wrapper px-4 mb-4">
    <!-- Dual range input -->
    <div class="relative">
      <!-- Track background -->
      <div class="absolute w-full h-2 bg-gray-200 rounded-lg" data-range-slider-target="track"></div>
      
      <!-- Active range -->
      <div class="absolute h-2 bg-blue-500 rounded-lg" data-range-slider-target="activeRange"></div>
      
      <!-- Min range input -->
      <input type="range" 
             name="<%= name %>[min]" 
             id="<%= id %>_min"
             min="<%= min %>" 
             max="<%= max %>" 
             step="<%= step %>"
             value="<%= value_min %>"
             class="absolute w-full h-2 bg-transparent appearance-none cursor-pointer range-input"
             data-range-slider-target="minSlider"
             data-action="input->range-slider#updateValues">
      
      <!-- Max range input -->
      <input type="range" 
             name="<%= name %>[max]" 
             id="<%= id %>_max"
             min="<%= min %>" 
             max="<%= max %>" 
             step="<%= step %>"
             value="<%= value_max %>"
             class="absolute w-full h-2 bg-transparent appearance-none cursor-pointer range-input"
             data-range-slider-target="maxSlider"
             data-action="input->range-slider#updateValues">
    </div>
  </div>

  <!-- Value display and inputs -->
  <div class="flex items-center justify-between gap-4">
    <div class="flex-1">
      <% if show_inputs %>
        <input type="text" 
               data-range-slider-target="minInput"
               data-action="blur->range-slider#updateFromInput"
               class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center text-sm"
               placeholder="최소값">
      <% else %>
        <span class="block text-center py-2 text-sm font-medium" data-range-slider-target="minLabel">
          <%= number_with_delimiter(value_min) %><%= unit %>
        </span>
      <% end %>
    </div>
    
    <span class="text-gray-400 text-sm">~</span>
    
    <div class="flex-1">
      <% if show_inputs %>
        <input type="text" 
               data-range-slider-target="maxInput"
               data-action="blur->range-slider#updateFromInput"
               class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center text-sm"
               placeholder="최대값">
      <% else %>
        <span class="block text-center py-2 text-sm font-medium" data-range-slider-target="maxLabel">
          <%= number_with_delimiter(value_max) %><%= unit %>
        </span>
      <% end %>
    </div>
  </div>
</div>

<style>
  /* Custom range input styling */
  .range-input {
    -webkit-appearance: none;
    pointer-events: none;
  }
  
  .range-input::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #3B82F6;
    border: 2px solid white;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    pointer-events: all;
    position: relative;
    z-index: 10;
  }
  
  .range-input::-webkit-slider-thumb:hover {
    background: #2563EB;
  }
  
  .range-input::-webkit-slider-thumb:active {
    background: #1D4ED8;
  }
  
  /* Firefox */
  .range-input::-moz-range-thumb {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #3B82F6;
    border: 2px solid white;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    pointer-events: all;
  }
  
  .range-input::-moz-range-track {
    background: transparent;
  }
</style>